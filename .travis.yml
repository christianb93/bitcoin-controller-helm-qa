language: go
dist: xenial


go:
  - 1.10.8

install:
  - pwd
  # Get script to perform VM setup from the bitcoin-controller repository
  - wget https://raw.githubusercontent.com/christianb93/bitcoin-controller/master/travis/setupVMAndCluster.sh
  - chmod 700 setupVMAndCluster.sh
  # and run it. This will install helm and kind, bring up a cluster and install helm into it
  - ./setupVMAndCluster.sh
  # make sure that we have KUBECONFIG set correctly for what follows
  - export KUBECONFIG=$(kind get kubeconfig-path --name="kind")
  # Install the controller using the helm chart from this commit, then
  # let us print some output to ease debugging if something goes wrong
  - pwd
  - helm install .
  - kubectl get pods --all-namespaces


script:
  - cd $TRAVIS_BUILD_DIR/../bitcoin-controller
  - id=$(docker run -d -p 18332:18332 christianb93/bitcoind:v1.0)
  - cd tests
  - go test -v -run "Integration"
